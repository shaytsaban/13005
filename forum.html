<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Discussion Forum - Financial Management 13005</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Arial', sans-serif; background: #f0f2f5; color: #1c2526; line-height: 1.6; }
    header { background: linear-gradient(135deg, #007bff, #0056b3); color: #fff; padding: 25px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    header h1 { font-size: 2.2em; margin-bottom: 8px; }
    header p { font-size: 1.1em; opacity: 0.9; }
    .nav-bar { margin-top: 15px; }
    .nav-bar a { color: #fff; text-decoration: none; padding: 10px 25px; font-size: 1em; border-radius: 25px; transition: background 0.3s; }
    .nav-bar a:hover { background: rgba(255,255,255,0.2); }
    .container { max-width: 1000px; margin: 40px auto; padding: 0 20px; }
    .new-thread { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px; }
    .new-thread h2 { color: #007bff; font-size: 1.5em; margin-bottom: 15px; }
    .new-thread input, .new-thread textarea { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 1em; transition: border-color 0.3s; }
    .new-thread input:focus, .new-thread textarea:focus { border-color: #007bff; outline: none; }
    .new-thread input[type="file"] { padding: 5px; }
    .new-thread button { background: #28a745; color: #fff; padding: 12px 25px; border: none; border-radius: 25px; font-size: 1em; cursor: pointer; transition: background 0.3s; }
    .new-thread button:hover { background: #218838; }
    .forum-thread { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); transition: transform 0.2s; }
    .forum-thread:hover { transform: translateY(-2px); }
    .thread-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; border-bottom: 1px solid #eef2f5; }
    .thread-header h3 { color: #007bff; font-size: 1.3em; }
    .thread-meta { font-size: 0.85em; color: #666; }
    .thread-content { margin: 15px 0; }
    .attachment-preview { margin-top: 10px; max-width: 200px; border-radius: 8px; }
    .replies { margin-left: 25px; margin-top: 15px; }
    .reply { padding: 15px; background: #fafafa; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 1px 5px rgba(0,0,0,0.03); }
    .new-reply { margin-top: 15px; }
    .new-reply textarea { padding: 10px; border-radius: 8px; }
    .new-reply button { padding: 8px 20px; border-radius: 20px; font-size: 0.9em; }
    .delete-btn { background: #dc3545; color: #fff; padding: 6px 12px; border: none; border-radius: 20px; font-size: 0.8em; cursor: pointer; transition: background 0.3s; display: none; }
    .delete-btn:hover { background: #c82333; }
    .admin .delete-btn { display: inline-block; }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ“¢ Discussion Forum</h1>
    <p>Financial Management 13005 | Share your thoughts and questions</p>
    <div class="nav-bar">
      <a href="../index.html">Home</a>
      <a href="./forum.html">Discussion Forum</a>
    </div>
  </header>

  <div class="container">
    <section class="new-thread">
      <h2>Start a New Discussion</h2>
      <input type="text" id="threadTitle" placeholder="Thread Title">
      <textarea id="threadContent" placeholder="Write your message here..." rows="4"></textarea>
      <input type="file" id="threadFile" accept="image/*,.pdf,.doc,.docx">
      <button onclick="createThread()">Post Thread</button>
    </section>

    <section id="threads"></section>
  </div>

  <script>
    const isAdmin = true; // Placeholder; will be replaced with backend auth
    if (isAdmin) document.body.classList.add('admin');

    window.onload = function() {
      const threads = JSON.parse(localStorage.getItem('forumThreads')) || [];
      threads.forEach(thread => renderThread(thread));
    };

    function createThread() {
      const title = document.getElementById('threadTitle').value;
      const content = document.getElementById('threadContent').value;
      const fileInput = document.getElementById('threadFile');
      if (!title || !content) {
        alert('Please fill in both title and content');
        return;
      }

      const thread = {
        id: Date.now(),
        title,
        content,
        date: new Date().toLocaleString(),
        replies: [],
        attachment: null
      };

      if (fileInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          thread.attachment = {
            name: fileInput.files[0].name,
            data: e.target.result,
            type: fileInput.files[0].type
          };
          saveAndRenderThread(thread);
        };
        reader.readAsDataURL(fileInput.files[0]);
      } else {
        saveAndRenderThread(thread);
      }
    }

    function saveAndRenderThread(thread) {
      const threads = JSON.parse(localStorage.getItem('forumThreads')) || [];
      threads.unshift(thread);
      localStorage.setItem('forumThreads', JSON.stringify(threads));
      renderThread(thread, true);
      document.getElementById('threadTitle').value = '';
      document.getElementById('threadContent').value = '';
      document.getElementById('threadFile').value = '';
    }

    function renderThread(thread, prepend = false) {
      const threadsSection = document.getElementById('threads');
      const threadDiv = document.createElement('div');
      threadDiv.className = 'forum-thread';
      threadDiv.dataset.id = thread.id;

      let attachmentHtml = '';
      if (thread.attachment) {
        if (thread.attachment.type.startsWith('image/')) {
          attachmentHtml = `<img src="${thread.attachment.data}" class="attachment-preview" alt="${thread.attachment.name}">`;
        } else {
          attachmentHtml = `<p>Attachment: <a href="${thread.attachment.data}" download="${thread.attachment.name}">${thread.attachment.name}</a></p>`;
        }
      }

      threadDiv.innerHTML = `
        <div class="thread-header">
          <div>
            <h3>${thread.title}</h3>
            <div class="thread-meta">Posted on ${thread.date}</div>
          </div>
          <button class="delete-btn" onclick="deleteThread(${thread.id})">Delete</button>
        </div>
        <div class="thread-content">${thread.content}</div>
        ${attachmentHtml}
        <div class="replies" id="replies-${thread.id}"></div>
        <div class="new-reply">
          <textarea placeholder="Write a reply..." rows="2"></textarea>
          <input type="file" accept="image/*,.pdf,.doc,.docx">
          <button onclick="createReply(this, ${thread.id})">Reply</button>
        </div>
      `;

      if (prepend) {
        threadsSection.insertBefore(threadDiv, threadsSection.firstChild);
      } else {
        threadsSection.appendChild(threadDiv);
      }

      thread.replies.forEach(reply => renderReply(reply, thread.id));
    }

    function deleteThread(threadId) {
      if (confirm('Are you sure you want to delete this thread and all its replies?')) {
        let threads = JSON.parse(localStorage.getItem('forumThreads')) || [];
        threads = threads.filter(t => t.id !== threadId);
        localStorage.setItem('forumThreads', JSON.stringify(threads));
        document.querySelector(`[data-id="${threadId}"]`).remove();
      }
    }

    function createReply(button, threadId) {
      const replyText = button.previousElementSibling.previousElementSibling.value;
      const fileInput = button.previousElementSibling;
      if (!replyText) {
        alert('Please write a reply');
        return;
      }

      const reply = {
        id: Date.now(),
        content: replyText,
        date: new Date().toLocaleString(),
        attachment: null
      };

      if (fileInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          reply.attachment = {
            name: fileInput.files[0].name,
            data: e.target.result,
            type: fileInput.files[0].type
          };
          saveAndRenderReply(reply, threadId);
        };
        reader.readAsDataURL(fileInput.files[0]);
      } else {
        saveAndRenderReply(reply, threadId);
      }
    }

    function saveAndRenderReply(reply, threadId) {
      const threads = JSON.parse(localStorage.getItem('forumThreads')) || [];
      const thread = threads.find(t => t.id === threadId);
      thread.replies.push(reply);
      localStorage.setItem('forumThreads', JSON.stringify(threads));
      renderReply(reply, threadId);
      const threadDiv = document.querySelector(`[data-id="${threadId}"]`);
      threadDiv.querySelector('textarea').value = '';
      threadDiv.querySelector('input[type="file"]').value = '';
    }

    function renderReply(reply, threadId) {
      const repliesDiv = document.getElementById(`replies-${threadId}`);
      const replyDiv = document.createElement('div');
      replyDiv.className = 'reply';
      replyDiv.dataset.id = reply.id;

      let attachmentHtml = '';
      if (reply.attachment) {
        if (reply.attachment.type.startsWith('image/')) {
          attachmentHtml = `<img src="${reply.attachment.data}" class="attachment-preview" alt="${reply.attachment.name}">`;
        } else {
          attachmentHtml = `<p>Attachment: <a href="${reply.attachment.data}" download="${reply.attachment.name}">${reply.attachment.name}</a></p>`;
        }
      }

      replyDiv.innerHTML = `
        <div class="thread-content">${reply.content}</div>
        ${attachmentHtml}
        <div class="thread-meta">Reply on ${reply.date}
          <button class="delete-btn" onclick="deleteReply(${threadId}, ${reply.id})">Delete</button>
        </div>
      `;
      repliesDiv.appendChild(replyDiv);
    }

    function deleteReply(threadId, replyId) {
      if (confirm('Are you sure you want to delete this reply?')) {
        const threads = JSON.parse(localStorage.getItem('forumThreads')) || [];
        const thread = threads.find(t => t.id === threadId);
        thread.replies = thread.replies.filter(r => r.id !== replyId);
        localStorage.setItem('forumThreads', JSON.stringify(threads));
        document.querySelector(`#replies-${threadId} [data-id="${replyId}"]`).remove();
      }
    }
  </script>
</body>
</html>
